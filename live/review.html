<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revue des Sessions - Quiz Live</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="live-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="live-container">
        <!-- Phase 1: Session Selection -->
        <div id="select-phase" class="phase">
            <header class="live-header">
                <a href="../index.html" class="back-btn">
                    <i class="fas fa-arrow-left"></i> Retour
                </a>
                <h1><i class="fas fa-history"></i> Historique des Sessions</h1>
            </header>

            <div class="select-content">
                <div class="sessions-list" id="sessions-list">
                    <div class="loading-sessions">
                        <i class="fas fa-spinner fa-spin"></i>
                        <span>Chargement des sessions...</span>
                    </div>
                </div>
                <div id="no-sessions" class="no-sessions hidden">
                    <i class="fas fa-inbox"></i>
                    <p>Aucune session terminee</p>
                    <a href="teacher.html" class="btn-primary">
                        <i class="fas fa-plus"></i> Creer une session
                    </a>
                </div>
            </div>
        </div>

        <!-- Phase 2: Review Mode -->
        <div id="review-phase" class="phase hidden">
            <header class="live-header review-header">
                <button class="back-btn" onclick="backToList()">
                    <i class="fas fa-arrow-left"></i> Sessions
                </button>
                <div class="review-nav">
                    <button id="prev-question-btn" class="btn-nav" disabled>
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span id="question-indicator">1/10</span>
                    <button id="next-question-btn" class="btn-nav">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <button id="broadcast-btn" class="btn-broadcast">
                    <i class="fas fa-broadcast-tower"></i>
                    <span>Diffuser</span>
                </button>
            </header>

            <!-- Broadcast panel with QR code -->
            <div id="broadcast-panel" class="broadcast-panel hidden">
                <div class="broadcast-header">
                    <span class="pulse"></span>
                    <span>Diffusion en cours</span>
                </div>
                <div class="broadcast-join-info">
                    <div id="broadcast-qr-code" class="broadcast-qr"></div>
                    <div class="broadcast-details">
                        <p class="broadcast-code-label">Code de session</p>
                        <div class="broadcast-code-box" id="broadcast-code">------</div>
                        <p class="broadcast-url">
                            <i class="fas fa-link"></i>
                            <span id="broadcast-join-link">---</span>
                            <button class="btn-icon" onclick="copyReviewLink()" title="Copier le lien">
                                <i class="fas fa-copy"></i>
                            </button>
                        </p>
                    </div>
                </div>
            </div>

            <div class="review-content">
                <!-- Session info bar -->
                <div class="review-session-info">
                    <span id="review-quiz-title">Quiz</span>
                    <span class="separator">|</span>
                    <span id="review-session-date">Date</span>
                    <span class="separator">|</span>
                    <span><i class="fas fa-users"></i> <span id="review-participant-count">0</span> participants</span>
                </div>

                <!-- Question display -->
                <div class="question-display review-question">
                    <h2 id="question-text">Question...</h2>
                    <div class="review-answers" id="answer-options">
                        <!-- Answer options will be injected here -->
                    </div>
                </div>

                <!-- Explanation panel -->
                <div class="explanation-panel" id="explanation-panel">
                    <h4><i class="fas fa-lightbulb"></i> Explication</h4>
                    <p id="explanation-text"></p>
                </div>

                <!-- Distribution chart -->
                <div class="distribution-panel">
                    <h3><i class="fas fa-chart-bar"></i> Distribution des reponses</h3>
                    <div class="results-chart" id="distribution-chart">
                        <!-- Chart bars will be injected here -->
                    </div>
                    <div class="answer-stats">
                        <span><i class="fas fa-check-circle"></i> <span id="correct-count">0</span> bonnes reponses</span>
                        <span><i class="fas fa-times-circle"></i> <span id="wrong-count">0</span> mauvaises reponses</span>
                    </div>
                </div>

                <!-- Participant answers table -->
                <div class="participant-answers-panel">
                    <h3><i class="fas fa-users"></i> Reponses des participants</h3>
                    <table class="participant-answers-table">
                        <thead>
                            <tr>
                                <th>Participant</th>
                                <th>Reponse</th>
                                <th>Resultat</th>
                            </tr>
                        </thead>
                        <tbody id="participant-answers-body">
                            <!-- Rows will be injected here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Firebase not configured warning -->
        <div id="firebase-warning" class="warning-banner hidden">
            <i class="fas fa-exclamation-triangle"></i>
            <span>Firebase n'est pas configure. Veuillez configurer <code>js/firebase-config.js</code></span>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
    <script src="../js/config.js"></script>
    <script src="../js/firebase-config.js"></script>
    <script src="live-common.js"></script>
    <script src="review.js"></script>
</body>
</html>
